# 페이지네이션 구현

## 개요

리소스의 특성과 사용 패턴에 따라 적절한 페이지네이션 방식을 선택하여 구현했습니다.

## 구현 방식 비교

### Offset 기반 vs Cursor 기반

```mermaid
graph LR
    subgraph "Offset 기반"
        A1[장점: 구현 간단, 임의 페이지 접근]
        A2[단점: 대용량 데이터에서 성능 저하]
        A3[용도: 게시판 목록]
    end
    
    subgraph "Cursor 기반"
        B1[장점: 일관된 성능, 실시간 데이터 변경 대응]
        B2[단점: 임의 페이지 접근 불가]
        B3[용도: 게시글 목록]
    end
```

## 게시판 목록 페이지네이션 (Offset 기반)

### 선택 이유
1. **변동성 있는 정렬 기준**: `post_count`는 지속적으로 변경됨
2. **실시간성 덜 중요**: 게시글 수 순서의 즉시 반영이 중요하지 않음
3. **Cursor 방식 부적절**: `post_count` 값이 변경되면 cursor 위치가 무의미해짐

### 구현
```python
def get_accessible_boards(self, db: Session, user_id: int, limit: int = 20, offset: int = 0):
    return db.query(Board)\
        .filter((Board.public.is_(True)) | (Board.owner_id == user_id))\
        .order_by(Board.post_count.desc(), Board.id)\
        .limit(limit).offset(offset).all()
```

### API 사용법
```http
GET /boards?limit=20&offset=0
GET /boards?limit=20&offset=20
```

## 게시글 목록 페이지네이션 (Cursor 기반)

### 선택 이유
1. **고정된 정렬 기준**: `created_at`은 생성 후 변경되지 않음
2. **무한스크롤 적합**: 연속적인 데이터 로딩에 최적화
3. **일관된 성능**: 데이터량 증가와 무관하게 일정한 성능

### 구현
```python
def get_posts_by_board(self, db: Session, board_id: int, 
                      cursor_time: Optional[datetime] = None, 
                      cursor_id: Optional[int] = None, 
                      limit: int = 20):
    query = db.query(Post).filter(Post.board_id == board_id)
    
    if cursor_time and cursor_id:
        query = query.filter(
            (Post.created_at < cursor_time) | 
            ((Post.created_at == cursor_time) & (Post.id < cursor_id))
        )
    
    return query.order_by(Post.created_at.desc(), Post.id.desc()).limit(limit).all()
```

### API 사용법
```http
# 첫 페이지
GET /boards/1/posts?limit=20

# 다음 페이지 (마지막 게시글의 시간과 ID 사용)
GET /boards/1/posts?limit=20&cursor_time=2025-09-03T06:41:16&cursor_id=5
```

## 인덱스 설계

```sql
-- 게시글 목록용 복합 인덱스  
CREATE INDEX idx_posts_board_created ON posts (board_id, created_at DESC, id DESC);
```

## 각 방식의 특징

### 게시판 목록 (Offset)
- **변동 기준값**: `post_count` 값이 Redis 동기화에 따라 변경
- **페이지 탐색**: 사용자가 특정 페이지로 이동 가능
- **성능**: 적은 게시판 수로 인해 깊은 페이지에서도 성능 문제 없음

### 게시글 목록 (Cursor)  
- **고정 기준값**: `created_at`, `id`는 생성 후 불변
- **무한스크롤**: 연속적인 다음 페이지 로딩
- **일관성**: 새 게시글 추가되어도 기존 cursor 결과 일관성 유지